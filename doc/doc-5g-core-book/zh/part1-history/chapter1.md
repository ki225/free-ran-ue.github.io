# 第 1 章：從 4G 到 5G — 核心網架構的演變

## 1.1 什麼是核心網路？

我們可以把核心網路想像成「電信系統的大腦」，負責在用戶設備（手機、UE）和外部世界（例如網際網路、企業專網、其他營運商網路）之間做各種決策與協調。當一支手機開機、註冊、上網、打電話、或是使用各種 App 的時候，背後大部分關鍵的控制邏輯，都是由核心網路在處理。

核心網路的功能可以大致分成幾個面向：

1. **用戶註冊**

    負責辨識「你是誰」，確認你是否是合法用戶、你的門號是否有效、有沒有欠費、允不允許漫遊等。以 4G/5G 來說，這會牽涉到**鑑權（Authentication）**、**位置登錄（Registration/Attach）**，以及為每個用戶建立對應的**會話上下文（Session/Context）**。

2. **資源管理**

    當用戶開始傳輸數據（例如開 YouTube、開 Teams）、或建立語音通話時，核心網路需要為這些流量分配適當的資源。這包含：

    - 建立與釋放 EPS Bearer（4G） / PDU Session（5G）
    - 配置 QoS（如延遲、優先順序、保證頻寬）
    - 與 RAN 協調無線資源使用（例如哪些使用者可以拿到比較高優先權）

3. **流量導向**

    核心網路決定「這些封包要往哪裡走」。例如：

    - 上網流量要送到哪一個 P-GW（4G） / UPF（5G）
    - 特定服務（VoLTE、VoNR、IMS）是否需要送到特殊的應用伺服器

    在 5G 架構下，這也會牽涉到 **Uplink Classifier（UL CL）**、**分流（Traffic Steering）** 等設計。

4. **計費**

    電信營運商需要知道每個用戶用了多少流量、通了多久的電話、是否使用了特定的增值服務，才能進行後續的計費與對帳。核心網路會：

    - 蒐集使用量資訊（流量、時間、事件）
    - 產生計費紀錄
    - 與計費系統互動，支援即時（oneline）或離線(offline)計費

總結來說，無論是 2G、3G、4G 還是 5G，核心網路的本質都沒有改變：負責「**認人、配資源、決定路線、算錢**」。差別只是在不同世代中，協定、介面與功能拆分方式不斷演進，使得核心網路可以支援更多樣的服務、更細緻的 QoS，以及更高的彈性與可程式化能力。

## 1.2 4G EPC

### 1.2.1 EPC 架構總覽

在 4G 系統中，EPC（Evolved Packet Core，演進封包核心網路）負責把無線接取（eNodeB）與各種外部網路（例如 Internet、企業專網）串接起來。下面簡單介紹幾個在 EPC 中最核心的網元：HSS、MME、S-GW、P-GW 以及 eNodeB。

![epc](./image/epc.png)

- HSS（Home Subscriber Server）

    - 儲存用戶的基本資料：例如 IMSI、MSISDN、服務權限、漫遊權限等
    - 儲存與鑑權相關的金鑰與參數，用來和 UE 做安全驗證
    - 提供用戶所屬的網路位置與漫遊資訊，讓 MME 能找到正確的用戶與網路

- MME（Mobility Management Entity）

    - 負責 UE 的註冊（Attach）與釋放流程
    - 負責行動性管理（Mobility Management），例如追蹤 UE 所在的 eNodeB、切換（Handover）協調
    - 負責驗證用戶身分（透過與 HSS 溝通），決定是否允許該 UE 使用網路
    - 在建立數據承載時，與 S-GW / P-GW 協調，建立對應的 EPS Bearer

- S-GW（Serving Gateway）

    - 負責在 eNodeB 與 P-GW 之間轉送使用者面（User Plane）封包
    - 當 UE 在不同 eNodeB 或不同區域之間移動時，S-GW 可以作為數據流量的穩定錨點，減少路徑重建的成本
    - 負責部份計費與流量統計相關功能，提供給後端系統使用

- P-GW（Packet Data Network Gateway）

    - 負責為 UE 分配 IP 位址，讓 UE 可以和 Internet 或企業專網通訊
    - 負責執行各種策略與計費控制（與 PCRF 互動），例如頻寬限制、阻擋/允許特定服務、流量整形等
    - 常常是企業專網、IMS 系統或各種應用伺服器的匯入點

- eNodeB（Evolved Node B）

    - 4G 基地台
    - 負責無線電資源管理：包括排程、調變編碼、功率控制等
    - 將 UE 的無線信號轉成 IP 封包，透過 S1-U 介面送往 S-GW
    - 透過 S1-MME 介面與 MME 溝通控制訊號（像是 RRC 連線、Attach、TAU 等）
    - 支援 eNodeB 之間的 X2 介面，用於切換（Handover）與負載平衡

### 1.2.2 2G/3G/4G 的核心網路限制

在 2G/3G/4G 的時代，核心網路雖然已經可以支援語音、簡訊與行動上網，但在架構與功能上，仍存在幾個關鍵限制，讓它很難滿足後來 5G 所追求的**高彈性**、**高效率**與**多樣化服務**需求：

- 架構封閉、網元綁死

    - 多數功能被打包在少數大型網元中（如 SGSN/GGSN、MME/S-GW/P-GW），彼此高度耦合。
    - 想要新增功能或優化路徑，常常會受到設備廠商與既有介面的限制，缺乏彈性。

- 控制面與使用者面的分離不夠徹底

    - 雖然在 4G EPC 中已經開始切分控制面（MME）和使用者面（S-GW/P-GW），但在實作與部署上，仍經常以「整套設備」思維為主。
    - 對於後來希望做到的集中控制、多點分流、邊緣計算（MEC）等場景，支援度有限。

- 服務類型相對單一，QoS 彈性有限

    - 主要服務型態是「行動上網 + 語音/簡訊」，對 IoT、超高可靠低延遲（URLLC）、垂直產業專網等場景的原生支援不足。
    - QoS 雖然有等級區分，但難以做到針對不同業務、不同企業客戶，進行細緻又可程式化的策略控制。

- 擴展性與部署模式受限於硬體

    - 傳統核心網路多半以實體設備或虛擬機為主，垂直擴充（scale up）為主，橫向擴展（scale out）能力有限。
    - 難以配合流量高峰或臨時活動（例如大型演唱會、體育賽事）快速調整資源，更難做到「按需、彈性」的雲原生部署。

- 對雲原生與切片（Network Slicing）的支援不足

    - 2G/3G/4G 的設計並未以「多租戶、多切片」為前提，通常是一張網路服務所有用戶。
    - 要為不同企業、行業客製化一組核心網路邏輯或資源切片，成本高、彈性差，也不易自動化。

也因為上述這些限制，當行動網路從「單一大眾服務」走向「多元垂直場景」時，原有 2G/3G/4G 的核心網路架構就顯得吃力，這也成為 5G 重新設計核心網路（5GC）、導入服務化架構（SBA）、雲原生與網路切片（Network Slicing）等概念的重要背景。

## 1.3 5G 核心網路（5GC）的需求與設計理念

### 1.3.1 5G 核心網路的需求

5G 並不是單純把 4G「加快一點」而已，而是要同時支援三種完全不同特性的服務類型，這三大場景也直接決定了 5GC 的設計方向：

- **eMBB（enhanced Mobile Broadband，加強型行動寬頻）**

    主要目標是「更高的速率與更大的容量」，例如 4K/8K 串流、AR/VR、雲端遊戲等。  
    對核心網來說，必須能夠支援大量高頻寬流量，並在高負載情況下維持穩定的 QoS（例如吞吐量、延遲、丟包率）。

- **URLLC（Ultra-Reliable Low Latency Communications，超高可靠低延遲通訊）**

    針對自動駕駛、遠端手術、工業控制等場景，要求「毫秒級甚至次毫秒級延遲」以及極高可靠度。  
    這代表核心網路必須盡可能縮短資料路徑，並允許將使用者面功能下沉到邊緣（MEC），同時提供更細緻的優先權與保護機制。

- **mMTC（massive Machine Type Communications，大規模機器型通訊）**

    面向海量 IoT 裝置，例如智慧電表、感測器、穿戴裝置等，每個裝置本身流量不高，但「數量極大」。  
    核心網需要能支援高密度註冊、低成本連線，以及適合長時間待機、間歇性上報的連線模式（例如 5G 的節能與省電設計）。

除此之外，**多樣化 IoT 與垂直行業服務的爆發**，也對 5GC 提出了新的要求：

- 不同企業 / 行業（如工廠、自駕車、醫療）對安全、隔離性、延遲與可靠度的需求差異極大  
- 傳統「一張網路服務所有人」的模式已經不敷使用，需要能夠針對不同客戶、不同應用，快速打造客製化的網路「切片」與策略  
- 網路本身必須更容易與 IT / Cloud 環境整合，支援自動化部署、彈性擴展與 DevOps 模式

這些需求共同推動了 5G 核心網路從「傳統電信設備」走向「雲原生服務化架構」。

### 1.3.2 5G 核心網路的設計理念

為了滿足上述需求，3GPP 在設計 5GC 時，核心理念大致可歸納為三個關鍵方向：

- **SBA（Service-Based Architecture，服務化架構）引入**

    5GC 不再以「單一大型網元」為中心，而是將核心功能拆分成多個網路功能（NF），例如 AMF、SMF、UPF、UDM、PCF 等，並透過 **HTTP + JSON / REST 風格** 的介面進行互動。  
    每個 NF 對外提供清楚定義的「服務」，其他 NF 只要透過服務名稱就能發現並呼叫它，這種設計：

    - 讓網路功能可以獨立開發、升級與擴展  
    - 更容易導入微服務與容器化（如 Kubernetes）  
    - 讓電信網路更接近一般 IT / Cloud 系統的設計模式

- **CUPS（Control and User Plane Separation，控制面與使用者面分離）支援**

    雖然 4G EPC 就已開始做 CUPS，但在 5GC 中，控制面（例如 AMF、SMF）與使用者面（UPF）分離得更徹底。  
    如此一來：

    - 控制面可以集中部署、統一管理邏輯與策略  
    - 使用者面（UPF）可以依照需求分散到邊緣或不同地理位置，縮短資料路徑、降低延遲  
    - 更容易根據流量型態與服務需求，獨立對控制面或使用者面做擴縮容（scale in/out）

- **雲原生與網路切片（Network Slicing）**

    5GC 從設計之初就考慮在雲環境上運行，支援容器化、微服務與自動化編排。  
    在此基礎上，5GC 引入了 **Network Slicing** 概念：在同一套物理網路上，邏輯上切出多個端到端的「虛擬網路」，每一個切片可以有：

    - 不同的網路功能組合與配置  
    - 不同的 QoS 策略、安全等級與管理邏輯  
    - 對應不同客戶或行業場景（例如：一個切片專門給 mMTC，一個給 URLLC 工業控制）  

透過 SBA、CUPS 以及雲原生切片等設計，5G 核心網路相較於過去世代，從「單一用途、難以變更的電信專網」逐步演進為**「可程式化、可切片、可客製化的通用數位基礎設施」**，為後續更多創新應用預留了空間。

<div class="chapter-nav">
  <a href="../chapter2/" class="nav-btn nav-next" title="下一章：5G 核心網 3GPP 角度總覽">
    <span class="arrow"></span>
  </a>
</div>
